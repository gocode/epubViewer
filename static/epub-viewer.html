<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/paper-fab/paper-fab.html">

<dom-module id="epub-viewer">

	<style>
		:host {
			display: flex;
			justify-content: center;
			align-items: center;
		}

		:host ::content #epubviewer {			
	    	height: 600px;
	    	width: 100%;
	    	border-width: 0px;
	    }

	    :host ::content paper-fab {
			margin: 30px;
			background: #3f51b5;
			color: #fff;
		}
	</style>

	<template>
		<paper-fab on-click="prev" icon="arrow-back"></paper-fab>
		<iframe id="epubviewer"></iframe>
		<paper-fab on-click="next" icon="arrow-forward"></paper-fab>
	</template>

	<script>
		Polymer({
			is: "epub-viewer",

			attached: function() {
				this.$.epubviewer.addEventListener('load', function() {
					var css = document.createElement('link');
					css.rel = 'stylesheet';
					css.href = 'static/epub.css';
					this.$.epubviewer.appendChild(css);

					var script = document.createElement('script');
					script.type = 'text/javascript';
					script.async = true;
					script.src = 'static/epub.js';
					this.$.epubviewer.appendChild(script);
				});
			},

			prev: function() {
				jQuery.ajax({
				    url: '/prevpage',
				    data: {href: document.querySelector('#epubviewer').contentWindow.location.pathname},
				    type: 'POST',
				    success: function(data){
				    	document.querySelector('#epubviewer').src = 'http://localhost:9090/' + JSON.parse(data).Href;
				    }
				});
			},

			next: function() {
				jQuery.ajax({
				    url: '/nextpage',
				    data: {href: document.querySelector('#epubviewer').contentWindow.location.pathname},
				    type: 'POST',
				    success: function(data){
				    	document.querySelector('#epubviewer').src = 'http://localhost:9090/' + JSON.parse(data).Href;
				    }
				});
			}

		});
	</script>

</dom-module>