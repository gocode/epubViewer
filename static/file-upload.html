<link rel="import" href="/static/bower_components/polymer/polymer.html">
<link rel="import" href="/static/bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="/static/bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="/static/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/static/bower_components/paper-button/paper-button.html">
<link rel="import" href="/static/bower_components/iron-icons/iron-icons.html">
<link rel="import" href="/static/bower_components/iron-form/iron-form.html">

<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

<script src="/static/ajax.js"></script>

<dom-module id="file-upload">

	<style>
		#container {
			height: 100vh;
	    	width: 100%;
		}

		paper-toolbar {
			text-align: center;
		}

		form {
			height: 500px;
			display: flex;
			justify-content: center;
			align-items: center;
		}

		#uploadbox {
			display: flex;
			height: 50px;
			width: 800px;
			margin: 5px;
		}

		paper-button {
			display: flex;
			justify-content: center;
			align-items: center;
			width: 100px;	
			margin: 0px;
			background: #3f51b5;
			color: #fff;
		}

		paper-item {
			display: flex;
			justify-content: center;
			align-items: center;
			border-top-style: solid;
			border-bottom-style: solid;
			border-width: 1px;
			width: 600px;
			font-family: 'Roboto';
			font-style: italic;
			font-size: 20px;
		}

		input {
			visibility: hidden;
			width: 0px;
			height: 0px;
		}
	</style>

	<template>
		<div id="container" fullbleed layout vertical>
			<paper-header-panel class="flex">
				<paper-toolbar>
					<paper-icon-button icon="view-list" on-click="gotoFileList"></paper-icon-button>
					<div class="title">Epub Reader</div>
				</paper-toolbar>

				<div id="content" class="fit">
					<form id="epubuploadform" action="/upload" method="POST" enctype='multipart/form-data'>
						<div id="uploadbox">
							<paper-button on-click="browseFile">
								<iron-icon icon="search"></iron-icon>
							</paper-button>
							<paper-item id="filename"></paper-item>
							<paper-button on-click="submitForm">
								<iron-icon icon="file-upload"></iron-icon>
							</paper-button>
						</div>
				    	<input type="file" id="epubupload" name="epubupload" on-change="changeName"></input>
					</form>
				</div>
			</paper-header-panel>
		</div>
	</template>

	<script>
		Polymer({
			is: 'file-upload',

			browseFile: function() {
				this.$.epubupload.click();
			},

			changeName: function() {
				this.$.filename.innerHTML = this.$.epubupload.files[0].name;
			},

			submitForm: function() {
				var container = this.$.container;
				container.style.cursor = 'wait';
				ajax({
					method: 'POST',
					url: '/upload',
					data: {
						epubupload: this.$.epubupload.files[0]
					},
					success: function(response) {
						document.location = JSON.parse(response).Href;
						container.style.cursor = 'auto';
					},
					error: function() {
						console.log('unable to upload file');
						container.style.cursor = 'auto';
					}
				});
			},

			gotoFileList: function() {
				document.location = '/static/filelist.html';
			}
		});
	</script>

</dom-module>


