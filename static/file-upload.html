<link rel="import" href="/static/bower_components/polymer/polymer.html">
<link rel="import" href="/static/bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="/static/bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="/static/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/static/bower_components/paper-button/paper-button.html">
<link rel="import" href="/static/bower_components/iron-icons/iron-icons.html">
<link rel="import" href="/static/bower_components/iron-form/iron-form.html">
<link rel="import" href="/static/bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="/static/bower_components/iron-flex-layout/classes/iron-flex-layout.html">

<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

<script src="/static/ajax.js"></script>

<dom-module id="file-upload">

	<style>
		.title {
			text-align: center;
		}

		#content {
			@apply(--layout-horizontal);
			@apply(--layout-center);
      		@apply(--layout-center-justified);
		}

		#uploadbox {
			display: flex;
		}

		paper-button {
			margin: 0px;
			background: #3f51b5;
			color: #fff;
		}

		paper-item {
			@apply(--layout-horizontal);
			@apply(--layout-center);
      		@apply(--layout-center-justified);
			border-top-style: solid;
			border-bottom-style: solid;
			border-width: 1px;
			width: 600px;
			font-family: 'Roboto';
			font-style: italic;
			font-size: 20px;
		}

		input {
			visibility: hidden;
			width: 0px;
			height: 0px;
		}
	</style>

	<template>
		<paper-header-panel>
			<paper-toolbar>
				<paper-icon-button icon="view-list" on-click="gotoFileList"></paper-icon-button>
				<div class="title">Epub Reader</div>
			</paper-toolbar>

			<div id="content" class="fit">
				<form id="epubuploadform" action="/upload" method="POST" enctype='multipart/form-data'>
					<div id="uploadbox">
						<paper-button on-click="browseFile">
							<iron-icon icon="search"></iron-icon>
						</paper-button>
						<paper-item id="filename"></paper-item>
						<paper-button on-click="submitForm">
							<iron-icon icon="file-upload"></iron-icon>
						</paper-button>
					</div>
			    	<input type="file" id="epubupload" name="epubupload" on-change="changeName"></input>
				</form>
			</div>
		</paper-header-panel>
	</template>

	<script>
		Polymer({
			is: 'file-upload',

			browseFile: function() {
				this.$.epubupload.click();
			},

			changeName: function() {
				this.$.filename.innerHTML = this.$.epubupload.files[0].name;
			},

			submitForm: function() {
				var container = this.$.container;
				this.style.cursor = 'wait';
				ajax({
					method: 'POST',
					url: '/upload',
					data: {
						epubupload: this.$.epubupload.files[0]
					},
					success: function(response) {
						document.location = JSON.parse(response).Href;
						container.style.cursor = 'auto';
					},
					error: function() {
						console.log('unable to upload file');
						container.style.cursor = 'auto';
					}
				});
			},

			gotoFileList: function() {
				document.location = '/';
			}
		});
	</script>

</dom-module>


