<link rel="import" href="/static/bower_components/polymer/polymer.html">
<link rel="import" href="/static/bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="/static/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/static/bower_components/paper-button/paper-button.html">
<link rel="import" href="/static/bower_components/iron-icons/iron-icons.html">
<link rel="import" href="/static/bower_components/iron-form/iron-form.html">

<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

<dom-module id="file-upload">

	<style>
		:host {
			height: 100%;
	    	width: 100%;
		}

		paper-toolbar {
			text-align: center;
		}

		form {
			height: 500px;
			display: flex;
			justify-content: center;
			align-items: center;
		}

		#uploadbox {
			display: flex;
			height: 50px;
			width: 800px;
			margin: 5px;
		}

		paper-button {
			display: flex;
			justify-content: center;
			align-items: center;
			width: 100px;	
			margin: 0px;
			background: #3f51b5;
			color: #fff;
		}

		paper-item {
			display: flex;
			justify-content: center;
			align-items: center;
			border-top-style: solid;
			border-bottom-style: solid;
			border-width: 1px;
			width: 600px;
			font-family: 'Roboto';
			font-style: italic;
			font-size: 20px;
		}

		input {
			visibility: hidden;
			width: 0px;
			height: 0px;
		}
	</style>

	<template>
		<div id="container" fullbleed layout vertical>
			<paper-header-panel class="flex">
				<paper-toolbar>
					<div class="title">Epub Reader</div>
				</paper-toolbar>

				<div id="content" class="fit">
					<form id="epubuploadform" action="/upload" method="POST" enctype='multipart/form-data'>
						<div id="uploadbox">
							<paper-button on-click="browseFile">
								<iron-icon icon="search"></iron-icon>
							</paper-button>
							<paper-item id="filename"></paper-item>
							<paper-button on-click="submitForm">
								<iron-icon icon="file-upload"></iron-icon>
							</paper-button>
						</div>
				    	<input type="file" id="epubupload" name="epubupload" on-change="changeName"></input>
					</form>
				</div>
			</paper-header-panel>
		</div>
	</template>

	<script>
		Polymer({
			is: 'file-upload',

			browseFile: function() {
				this.$.epubupload.click();
			},

			changeName: function() {
				this.$.filename.innerHTML = this.$.epubupload.files[0].name;
			},

			submitForm: function() {
    			var xhr = new XMLHttpRequest();
    			xmlhttp.onreadystatechange = function() {
        			if (xhr.readyState == XMLHttpRequest.DONE) {
           				if(xhr.status == 200){
               				document.location = JSON.parse(data).Href;
           				} else {
               				console.log('something else other than 200 was returned')
           				}
        			}
    			}

				var data = new FormData();
				data.append('epubupload', this.$.epubupload.files[0]);
				xhr.open('POST', '/upload');
				xhr.send(data);
			}
		});
	</script>

</dom-module>


